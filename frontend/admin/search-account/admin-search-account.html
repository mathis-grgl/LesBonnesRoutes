<!DOCTYPE html>
<html lang="fr-FR">
<head>
  {% set title='Administrateur - Recherche de compte utilisateur' %}
  {% include 'head.html' %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.3/css/dataTables.bootstrap5.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
  {% include 'scripts-required.html' %}

  <script src="https://cdn.datatables.net/1.13.3/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.3/js/dataTables.bootstrap5.min.js"></script>

  <script src="/static/js/accountTable.js"></script>

  {% include 'header.html' %}

  {% set section_name='Administrateur - Recherche de compte utilisateur' %}
  {% include 'inner-page.html' %}

  <!-- inclure le code ici -->

  <style>
    /* Pour l'affichage de la table */
    #accountTable {
      /* width: 80%; */
      text-align: center !important;
      vertical-align: middle !important;
    }

    #accountTable p {
      margin: auto !important;
    }

    #accountTable>tr,
    th,
    td {
      text-align: center !important;
      vertical-align: middle !important;
    }

    th.sorting {
      text-align: center !important;
    }


    /* Pour l'affichage de l'adresse e-mail */
    .emailLink {
      text-decoration: none;
    }
    .emailLink:hover {
      text-decoration: underline;
    }


    /* Pour l'affichage des étoiles */
    .rating {
      display: inline-block;
      position: relative;
      height: 30px;
      width: 90%;
      line-height: 30px;
      font-size: 20px;
      background-color: #eee;
      border-radius: 5px;
      overflow: hidden;
    }
    .stars {
      position: absolute;
      top: 0;
      left: 0;
      width: 0;
      height: 100%;
      background-color: #ffdd00;
      transition: width 0.5s ease;
    }
    .stars span:not(.rating-value) {
      display: inline-block;
      box-sizing: border-box;
      height: 100%;
      width: 20%;
      padding: 0;
      margin: 0;
      background-size: contain;
      background-repeat: no-repeat;
    }
    .rating-value {
      z-index: 99;
      position: relative;
      padding-left: 5px;
      font-size: 16px;
    }


  </style>

  <section class="col-md-12">
    <table id="accountTable" class="table table-striped table-bordered table-responsive-lg display" cellspacing="0"
      width="100%">
      <thead>
        <tr>
          <th>Nom de l'utilisateur</th>
          <th>Genre</th>
          <th>Photo</th>
          <th>E-mail</th>
          <th>Numéro de téléphone</th>
          <th>Note</th>
          <th>Modifier</th>
          <th>Supprimer</th>
        </tr>
      </thead>
      <tbody id="accountList"></tbody>
      <tfoot>
        <tr>
          <th>Nom de l'utilisateur</th>
          <th>Genre</th>
          <th>Photo</th>
          <th>E-mail</th>
          <th>Numéro de téléphone</th>
          <th>Note</th>
          <th>Modifier</th>
          <th>Supprimer</th>
        </tr>
      </tfoot>
    </table>
  </section>

  {% include 'footer.html' %}

  <script>
    $(document).ready(function () {
      var table = getAccountTable();
      $("[data-toggle=tooltip]").tooltip();

      // Ajout des utilisateurs depuis la BDD
      fetch('/admin/users')
      .then(reponse => {
        if (!reponse.ok) {
          throw new Error('Network response was not ok');
        }
        return reponse.json();
      })
      .then(data => {
        let nbCompte = data.length;
        let user = [];
        for (let i = 0; i < nbCompte; i++) {
          let account = data[i];
          
          // Création d'une nouvelle ligne
          let tr = document.createElement("tr");

          // Ajout du nom d'utilisateur
          let tdNom = document.createElement("td");
          tdNom.textContent = account.nomCompte + ' ' + account.prenomCompte;
          tr.appendChild(tdNom);

          // Ajout du genre
          let tdGenre = document.createElement("td");
          tdGenre.textContent = account.genre;
          tr.appendChild(tdGenre);

          // Ajout de la photo
          let tdImg = document.createElement("td");
          let img = document.createElement("img");
          img.src = "/static/images/person_" + i + ".jpg";
          img.alt = account.nomCompte;
          img.width = 64;
          img.height = 64;
          tdImg.appendChild(img);
          tr.appendChild(tdImg);

          // Ajout de l'e-mail
          let tdEmail = document.createElement("td");
          let aEmail = document.createElement("a");
          aEmail.classList.add("emailLink");
          aEmail.href = 'mailto:' + account.email;
          aEmail.textContent = account.email;
          tdEmail.appendChild(aEmail);
          tr.appendChild(tdEmail);

          // Ajout du numéro de téléphone
          let tdTelephone = document.createElement("td");
          tdTelephone.textContent = "(+33) " + account.telephone;
          tr.appendChild(tdTelephone);

          // Ajout de la note
          let tdNote = document.createElement("td");
          if (account.noteCompte != null) {
            tdNote.innerHTML = `
              <div class="rating">
                <div class="stars" style="width:` + 100*account.noteCompte/5.0 +`%">
                  <span></span>
                </div>
                <span class="rating-value">` + account.noteCompte + " / 5" + `</span>
              </div>
            `;
          } else {
            tdNote.innerHTML = "N/A";
            // tdNote.innerHTML = `
            //   <div class="rating">
            //     <div class="stars" style="width:0%">
            //       <span></span>
            //     </div>
            //     <span class="rating-value">N/A</span>
            //   </div>
            // `;
          }
          tr.appendChild(tdNote);

          // Ajout du bouton modifier
          let tdEdit = document.createElement("td");
          let pEdit = document.createElement("p");
          pEdit.setAttribute("data-placement", "top");
          pEdit.setAttribute("data-toggle", "tooltip");
          pEdit.setAttribute("title", "Edit");

          let btnEdit = document.createElement("a");
          btnEdit.classList.add("btn", "btn-primary", "btn-xs");
          btnEdit.onclick = () => {
            location.href = "/admin/account/edit/" + account.idCompte;
          }
          btnEdit.setAttribute("href", "/admin/account/edit/" + account.idCompte);
          btnEdit.setAttribute("data-title", "Edit");
          btnEdit.setAttribute("data-toggle", "modal");
          btnEdit.setAttribute("data-target", "#edit");

          let spanEdit = document.createElement("span");
          spanEdit.classList.add("fa", "fa-pencil");
          btnEdit.appendChild(spanEdit);
          pEdit.appendChild(btnEdit);
          tdEdit.appendChild(pEdit);
          tr.appendChild(tdEdit);

          // Ajout du bouton supprimer
          let tdDelete = document.createElement("td");
          let pDelete = document.createElement("p");
          pDelete.setAttribute("data-placement", "top");
          pDelete.setAttribute("data-toggle", "tooltip");
          pDelete.setAttribute("title", "Delete");

          let btnDelete = document.createElement("a");
          btnDelete.classList.add("btn", "btn-danger", "btn-xs");
          btnDelete.onclick = () => {
            location.href = "/admin/account/delete/" + account.idCompte;
          }
          btnDelete.setAttribute("href", "/admin/account/delete/" + account.idCompte);
          btnDelete.setAttribute("data-title", "Delete");
          btnDelete.setAttribute("data-toggle", "modal");
          btnDelete.setAttribute("data-target", "#delete");

          let spanDelete = document.createElement("span");
          spanDelete.classList.add("fa", "fa-trash");
          btnDelete.appendChild(spanDelete);
          pDelete.appendChild(btnDelete);
          tdDelete.appendChild(pDelete);
          tr.appendChild(tdDelete);

          // Ajout de la ligne complète
          table.row.add(tr).draw(false);
        }
      }).catch(error => {
        console.error(error);
      });

    });
  </script>
</body>
</html>